<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>宜宾学院隐藏信息插件 - 测试页面</title>
  <style>
    body {
      font-family: 'Microsoft YaHei', Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #f5f5f5;
      color: #333;
    }
    .container {
      max-width: 1000px;
      margin: 0 auto;
      background-color: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }
    h1 {
      color: #1a73e8;
      text-align: center;
    }
    textarea {
      width: 100%;
      height: 300px;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-family: monospace;
      margin-bottom: 15px;
    }
    button {
      background-color: #1a73e8;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      margin-right: 10px;
    }
    button:hover {
      background-color: #0d62c9;
    }
    .result {
      margin-top: 20px;
      padding: 15px;
      background-color: #f8f9fa;
      border-radius: 4px;
      border-left: 4px solid #1a73e8;
    }
    .success {
      background-color: #e6f4ea;
      border-left-color: #34a853;
    }
    .error {
      background-color: #fce8e6;
      border-left-color: #ea4335;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>宜宾学院隐藏信息插件测试页面</h1>
    <p>使用此页面可以测试插件的数据处理功能。请在下面的文本框中粘贴接收到的JSON响应数据，然后点击"测试数据处理"按钮。</p>
    
    <textarea id="jsonData" placeholder="在此处粘贴JSON数据..."></textarea>
    
    <div>
      <button id="testBtn">测试数据处理</button>
      <button id="clearBtn">清空</button>
      <button id="useExampleBtn">使用示例数据</button>
      <button id="viewCapturedBtn">查看已捕获数据</button>
    </div>
    
    <div id="result" class="result" style="display: none;"></div>
  </div>
  
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const jsonDataTextarea = document.getElementById('jsonData');
      const testBtn = document.getElementById('testBtn');
      const clearBtn = document.getElementById('clearBtn');
      const useExampleBtn = document.getElementById('useExampleBtn');
      const viewCapturedBtn = document.getElementById('viewCapturedBtn');
      const resultDiv = document.getElementById('result');
      
      // 测试数据处理
      testBtn.addEventListener('click', () => {
        const jsonData = jsonDataTextarea.value.trim();
        if (!jsonData) {
          showResult('请先输入JSON数据！', 'error');
          return;
        }
        
        try {
          // 尝试解析JSON，确保格式正确
          JSON.parse(jsonData);
          
          // 发送数据到background脚本
          chrome.runtime.sendMessage({
            action: "testData",
            data: jsonData
          }, (response) => {
            if (response && response.success) {
              showResult('数据处理成功！请打开插件查看结果。', 'success');
            } else {
              showResult(`数据处理失败: ${response.error || '未找到有效的评分数据'}`, 'error');
            }
          });
        } catch (error) {
          showResult(`JSON格式错误: ${error.message}`, 'error');
        }
      });
      
      // 清空文本框
      clearBtn.addEventListener('click', () => {
        jsonDataTextarea.value = '';
        resultDiv.style.display = 'none';
      });
      
      // 使用示例数据
      useExampleBtn.addEventListener('click', () => {
        // 这里是示例数据结构
        const exampleData = {
          "msg": "操作成功！",
          "result": {
            "name": "示例项目",
            "college_export_score": [
              {
                "audit_time": "2025-03-17 13:14:27",
                "score": 81,
                "tch_no": "2001107009",
                "auto": 0,
                "role": "college",
                "stage": 0,
                "project_id": "example123456789",
                "is_support": 1,
                "tea_name": "测试老师1",
                "type": 0,
                "opinion": "这是测试意见1"
              },
              {
                "audit_time": "2025-03-12 15:06:04",
                "score": 90,
                "tch_no": "2021030004",
                "auto": 0,
                "role": "college",
                "stage": 0,
                "project_id": "example123456789",
                "is_support": 1,
                "tea_name": "测试老师2",
                "type": 0,
                "opinion": "这是测试意见2"
              }
            ],
            "dep_name": "测试学院"
          },
          "code": 200
        };
        
        jsonDataTextarea.value = JSON.stringify(exampleData, null, 2);
      });
      
      // 查看已捕获数据
      viewCapturedBtn.addEventListener('click', () => {
        chrome.runtime.sendMessage({ action: "getProjectData" }, (response) => {
          const data = response.data || {};
          const count = Object.keys(data).length;
          
          if (count === 0) {
            showResult('当前没有捕获到任何数据。', 'error');
          } else {
            showResult(`当前已捕获 ${count} 个项目的数据，请打开插件查看详情。`, 'success');
          }
        });
      });
      
      // 显示结果
      function showResult(message, type) {
        resultDiv.textContent = message;
        resultDiv.className = `result ${type}`;
        resultDiv.style.display = 'block';
      }
    });
  </script>
</body>
</html> 